<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Dashboard</title>
<style>
body{
  background:#121212;
  color:#fff;
  font-family:Poppins,sans-serif;
  padding:30px;
  position:relative;
}
h2{margin-bottom:20px;}
input{
  padding:10px;
  width:250px;
  border:none;
  border-radius:6px;
  background:#262626;
  color:#fff;
}
button{
  padding:10px 20px;
  margin-left:10px;
  background:#4CAF50;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button:hover{background:#43a047;}
.result{
  margin-top:20px;
  background:#1e1e1e;
  padding:20px;
  border-radius:10px;
  min-height:60px;
}
.logout{
  position:absolute;
  top:20px;
  right:20px;
  background:#e53935;
}
.logout:hover{background:#d32f2f;}
.uid-box{
  background:#1e1e1e;
  padding:15px;
  border-radius:10px;
  margin-bottom:25px;
}
</style>
</head>
<body>

<!-- âœ… Logged in user info -->
<div class="uid-box">
  <strong>Logged in User UID:</strong> <span id="userUid">Loadingâ€¦</span><br>
  <strong>Email:</strong> <span id="userEmail">Loadingâ€¦</span>
</div>

<h2>ðŸ”Ž Search User by ID Number</h2>
<input type="text" id="searchId" placeholder="Enter ID (e.g. USR-ABC123)">
<button id="searchBtn">Search</button>

<div class="result" id="result"></div>
<button class="logout" id="logoutBtn">Logout</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAhT_VolZsIz7F_AxnVkagd85ngXCGErQw",
  authDomain: "csat-2d59c.firebaseapp.com",
  databaseURL: "https://csat-2d59c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "csat-2d59c",
  storageBucket: "csat-2d59c.firebasestorage.app",
  messagingSenderId: "250094013303",
  appId: "1:250094013303:web:6e6dd3ee0dcac726486f72",
  measurementId: "G-YEJ32DTM64"
};

const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getDatabase(app);

const resultDiv  = document.getElementById("result");
const uidSpan    = document.getElementById("userUid");
const emailSpan  = document.getElementById("userEmail");

// âœ… Protect page & show current user info
onAuthStateChanged(auth,(user)=>{
  if(!user){
    window.location.href="index.html";
  } else {
    uidSpan.textContent   = user.uid;
    emailSpan.textContent = user.email || "No email";
  }
});

// âœ… Search by custom ID in Realtime Database
document.getElementById("searchBtn").addEventListener("click", async ()=>{
  const idInput = document.getElementById("searchId").value.trim();
  if(!idInput){ resultDiv.textContent="Enter an ID."; return; }

  const snapshot = await get(ref(db,"users"));
  let found=false;
  snapshot.forEach(childSnap=>{
    const data = childSnap.val();
    if(data.idNumber === idInput){
      resultDiv.innerHTML = `<b>Name:</b> ${data.name}<br>
                             <b>Email:</b> ${data.email}<br>
                             <b>ID:</b> ${data.idNumber}`;
      found=true;
    }
  });
  if(!found) resultDiv.textContent="âŒ No user found for this ID.";
});

// âœ… Logout
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  await signOut(auth);
  window.location.href="index.html";
});
</script>
</body>
</html>
